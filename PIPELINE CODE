# Earl Grey- S. mansoni
source $VSC_DATA/miniconda3/etc/profile.d/conda.sh
conda activate earlgrey

echo "CPUs allocated: $SLURM_CPUS_PER_TASK"
echo "Job started: $(date)"

earlGrey \
  -g $VSC_DATA/final_analysis/s_mansoni_fasta \
  -s schistosomaMansoni \
  -o $VSC_DATA/final_analysis/mansoni_out \
  -t $SLURM_CPUS_PER_TASK

echo "Job ended: $(date)"

# EDTA
source "$VSC_DATA/miniconda3/etc/profile.d/conda.sh"
conda activate EDTA

GENOME="$VSC_DATA/final_analysis/s_mansoni_fasta"
OUTDIR="$VSC_DATA/final_analysis/edta_runs/EDTA_Smansoni_${SLURM_JOB_ID}"

SCRATCH=${SLURM_TMPDIR:-/tmp/$SLURM_JOB_ID}
WORKDIR="$SCRATCH/edta_work"
mkdir -p "$WORKDIR"

rsync -avh "$GENOME" "$WORKDIR/"
cd "$WORKDIR"

GENOME_BASENAME="$(basename "$GENOME")"

EDTA.pl \
  --genome "$GENOME_BASENAME" \
  --species others \
  --step all \
  --anno 1 \
  --sensitive 1 \
  --force 1 \
  --threads "$THREADS"

mkdir -p "$OUTDIR"
rsync -avh "$WORKDIR"/ "$OUTDIR"/
